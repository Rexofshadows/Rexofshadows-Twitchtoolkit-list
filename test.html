<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-Piv4xVNRyMGpqkS2by6br4gNJ7DXjqk09RmUpJ8jgGtD7zP9yug3goQfGII0yAns" crossorigin="anonymous"></script>
    <title>Rexofshadows TwitchToolkit</title>
    <style>
    td.details-control {
    background: url('./details_open.png') no-repeat center center;
    cursor: pointer;
    }
    tr.shown td.details-control {
        background: url('./details_close.png') no-repeat center center;
    }
    </style>

  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Rexofshadows</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="#">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://www.twitch.tv/Rexofshadows">My Stream</a>
            </li>
      </div>
    </nav>
    <main role="main">
      <div class="jumbotron">
        <div class="row">
          <div class="container">
              <h1 class="display-3">TwitchToolkit</h1>
              <h6 class="display-7">If no data in tables please wait for it to load, freezes are not uncommon</h6>
              <p>TwitchToolkit is a mod written by Twitch.tv/hodlhodl that integrates storytelling decisions into chat votes, awards viewers coins for watching, and those coins can be spent on items/events in game.</p>
              <button type="button" class="btn btn-secondary" data-toggle="collapse" data-target="#demo">Common Commands</button>
              <div id="demo" class="collapse">
                <ul class="list-group">
                    <li class="list-group-item">!bal - check balance and karma rate</li>
                    <li class="list-group-item">!buy - Syntax: !buy beer 6 - purchase an item or event</li>
                    <li class="list-group-item">!whatiskarma - explains what the karma system is</li>
                    <li class="list-group-item">!purchaselist - gives users a link to the public purchase list</li>
                    <li class="list-group-item">!instructions - gives users info on using the mod</li>
                    <li class="list-group-item">!modinfo - gives users info about the mod</li>
                    <li class="list-group-item">!modsettings - gives user info on how many coins are being earned and global settings</li>
                    <li class="list-group-item">!giftcoins - Syntax: !giftcoins @username 100 - give another viewer your coins</li>
                    <li class="list-group-item">!toolkitcmds - shows all available commands to the user, this does not translate by default so it can be universally recognized.</li>
                    <li class="list-group-item">!buy ticket - join the viewer name queue</li>
                    <li class="list-group-item">!mypawnstory - view information about your pawns backstory</li>
                    <li class="list-group-item">!mypawnskills - view information about your pawns skills</li>
                </ul>
              </div>
          </div>
        </div>

        <div class="row">
          <div class="container">
            <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item">
                  <a class="nav-link active" data-toggle="tab" href="#item">Items</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" data-toggle="tab" href="#event">Events</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" data-toggle="tab" href="#race">Races</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" data-toggle="tab" href="#nolen">Nolen</a>
                </li>
              </ul>

              <!-- Tab panes -->
              <div class="tab-content">
                <div id="item" class="container tab-pane active bg-light"><br>
                  <div class="form-group row">
                      <label class="col-sm-2 col-form-label" for="">Price Between:</label>
                      <div class="col-sm-2">
                          <input type="number" class="form-control" id="item-price-min" placeholder="0">
                      </div>
                      <div class="col-sm-2">
                          <input type="number" class="form-control" id="item-price-max" placeholder="100000">
                      </div>
                  </div>
                  <div class="input-group input-group-sm mb-3">
                      <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroup-sizing-sm">Search</span>
                      </div>
                      <input type="text" id="searchinput" class="form-control search" aria-label="Search" aria-describedby="inputGroup-sizing-sm">
                  </div>
                    <table id="iDT" class="table display">
                      <thead class="thead-light" >
                        <tr>
                          <th>Name</th>
                          <th>Price</th>
                          <th>Category</th>
                        </tr>
                      </thead>
                      <tbody>
                      </tbody>
                    </table>
                </div>

                <!-- Event Tab -->
                <div id="event" class="container tab-pane fade bg-light"><br>
                  <div class="form-group row">
                      <label class="col-sm-2 col-form-label" for="">Price Between:</label>
                      <div class="col-sm-2">
                          <input type="number" class="form-control" id="item-price-min" placeholder="0">
                      </div>
                      <div class="col-sm-2">
                          <input type="number" class="form-control" id="item-price-max" placeholder="100000">
                      </div>
                  </div>
                  <div class="input-group input-group-sm mb-3">
                      <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroup-sizing-sm">Search</span>
                      </div>
                      <input type="text" id="searchinput" class="form-control search" aria-label="Search" aria-describedby="inputGroup-sizing-sm">
                  </div>
                  <p>Sort by clicking on table head!</p>
                  <table id= "eDT"class="table display">
                    <thead class="thead-light" >
                      <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>Karma Type</th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
                </div>

                <!-- Race Tab -->
                <div id="race" class="container tab-pane fade bg-light"><br>
                  <div class="form-group row">
                      <label class="col-sm-2 col-form-label" for="">Price Between:</label>
                      <div class="col-sm-2">
                          <input type="number" class="form-control" id="item-price-min" placeholder="0">
                      </div>
                      <div class="col-sm-2">
                          <input type="number" class="form-control" id="item-price-max" placeholder="100000">
                      </div>
                  </div>
                  <div class="input-group input-group-sm mb-3">
                      <div class="input-group-prepend">
                          <span class="input-group-text" id="inputGroup-sizing-sm">Search</span>
                      </div>
                      <input type="text" id="searchinput" class="form-control search" aria-label="Search" aria-describedby="inputGroup-sizing-sm">
                  </div>
                  <p>Sort by clicking on table head! (Tab WIP)</p>
                  <table id="rDT" class="table" style="width:100%">
                    <thead class="thead-light" >
                      <tr>
                        <th>Name</th>
                        <th>Price</th>
                        <th>defName</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>
                    </tbody>
                  </table>
                </div>
                <div id="nolen" class="container tab-pane fade bg-light"><br>
                  <p>How the code monkey who put this together from scratch feels</p>
                  <div class="tenor-gif-embed" data-postid="5064454" data-share-method="host" data-width="100%" data-aspect-ratio="1.4150943396226414"><a href="https://tenor.com/view/bloody-keyboard-typing-frustration-computer-gif-5064454">Bloody Keyboard GIF</a> from <a href="https://tenor.com/search/bloody-gifs">Bloody GIFs</a></div><script type="text/javascript" async src="https://tenor.com/embed.js"></script>
                </div>
              </div>


          </div>
        </div>
      </div>
    </main>
    <script>
      $(document).ready(function(){
        $('table.display').DataTable({
          // "ordering": false,
          "pageLength": 50,
          //"columnDefs": [{ "searchable": false, "targets": 1 }],
          "dom": 'lrtip'
        });

        var tab = "Items";

        $('.nav-tabs a').on('shown.bs.tab', function(event){
          tab = $(event.target).text();         // active tab
        });

        var itemDtable = $('#iDT').DataTable();
        updateItemList();
        var eventDtable = $('#eDT').DataTable();
        updateEventList();
        var raceDtable = null
        updateRaceList();

        function format(d){

         // `d` is the original data object for the row
         return '<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;">' +
             '<tr>' +
                 '<td>Mod:</td>' +
                 '<td>' + d.mod + '</td>' +
             '</tr>' +
             '<tr>' +
                 '<td>Description:</td>' +
                 '<td>' + d.description + '</td>' +
             '</tr>' +
             '<tr>' +
                 '<td>Extra info:</td>' +
                 '<td>And any further details here (images etc)...</td>' +
             '</tr>' +
         '</table>';
    }

        $('#rDT tbody').on('click', 'td.details-control', function () {
                var tr = $(this).closest('tr');
                var row = raceDtable.row( tr );

                if ( row.child.isShown() ) {
                    // This row is already open - close it
                    row.child.hide();
                    tr.removeClass('shown');
                }
                else {
                    // Open this row
                    row.child( format(row.data()) ).show();
                    tr.addClass('shown');
                }
            } );

        $("#searchinput, #item-price-min, #item-price-max").keyup(function() {
            if (tab == "Items") {
              itemDtable.draw();
            }
            else if (tab == "Events") {
              eventDtable.draw();
            }
            else if (tab == "Races") {
              raceDtable.draw();
            }
        });

        $.fn.dataTable.ext.search.push(
          function( settings, data, dataIndex) {
            var minPrice = parseInt($("#item-price-min").val());
            var maxPrice = parseInt($("#item-price-max").val());
            var value = $("#searchinput").val().toLowerCase();
            var tAllow = true;
            var pAllow = true;
            var name = data[0].toLowerCase();
            var price = parseFloat( data[1] ) || 0;
            var category = data[2].toLowerCase();


            if (!maxPrice && !minPrice || price >= minPrice && !maxPrice || price >= minPrice && price <= maxPrice || !minPrice && price <= maxPrice) {
                pAllow = true;
            }
            else {
              pAllow = false;
            }

            if(value !== ""){
              if (name.indexOf( value ) !== -1) {
                tAllow = true;
              } else if (category.indexOf( value ) !== -1) {
                tAllow = true;
              } else {
                tAllow = false;
              }
            }
            return tAllow && pAllow;
          }
        );

        function updateItemList() {
          // const element = document.getElementById("itemTable");
          const xmlhttp = new XMLHttpRequest();
          xmlhttp.onload = function() {
            var myObj = JSON.parse(this.responseText);
            for (var i = 0; i < myObj.total; i++) {
              if(myObj.items[i].price > 0){
                itemDtable.row.add( [
                  myObj.items[i].abr,
                  myObj.items[i].price,
                  myObj.items[i].category
                ]).draw();
              }
            }
          };
          xmlhttp.open("GET", "https://raw.githubusercontent.com/Rexofshadows/Rexofshadows-Twitchtoolkit-list/master/StoreItems.json");
          xmlhttp.send();
        }

        function updateEventList() {
          // const element = document.getElementById("eventTable");
          const xmlhttp = new XMLHttpRequest();
          xmlhttp.onload = function() {
            var myOBJ = JSON.parse(this.responseText);
            for (var i = 0; i < myOBJ.total; i++) {
              if(myOBJ.incitems[i].price > 0){
                eventDtable.row.add( [
                  myOBJ.incitems[i].abr,
                  myOBJ.incitems[i].price,
                  myOBJ.incitems[i].karmatype
                ]).draw();
              }
            }
          };
          xmlhttp.open("GET", "https://raw.githubusercontent.com/Rexofshadows/Rexofshadows-Twitchtoolkit-list/master/StoreIncidents.json");
          xmlhttp.send();
        }

        function updateRaceList() {


          const xmlhttp = new XMLHttpRequest();
          xmlhttp.onload = function() {
            var myOBJ = JSON.parse(this.responseText);
            raceDtable = $('#rDT').DataTable({
              "data": myOBJ.races,
              "columns": [
                {"data": "name"},
                {"data": "price"},
                {"data": "defName"},
                {
                    "className":      'details-control',
                    "orderable":      false,
                    "searchable":     false,
                    "data":           null,
                    "defaultContent": ''
                }],
                "dom": 'lrtip'
            });



          //   for (var i = 0; i < Object.keys(myOBJ.races).length; i++) {
          //     if(myOBJ.races[i].enabled == true){
          //       raceDtable.row.add( [
          //         myOBJ.races[i].name,
          //         myOBJ.races[i].price,
          //         myOBJ.races[i].defName
          //       ]).draw();
          //     }
          //   }
          };
          xmlhttp.open("GET", "https://raw.githubusercontent.com/Rexofshadows/Rexofshadows-Twitchtoolkit-list/master/ShopExt.json");
          xmlhttp.send();
        }


      });
    </script>
  </body>
</html>
